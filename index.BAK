<!DOCTYPE<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8">
    <title>#魔女図鑑 フリーアイコンガチャ</title>

    <style>

body {
  background-repeat: repeat;
  background-image: url(img/sys/bg.png);
  width: 512px;
  height: 512px;
}

div { margin: 2em }

img.title { width: 100%; }


ul {
	display: flex;
	justify-content: center;
	padding: 0;
}

li {
	list-style: none;
	margin: 0 0.1em;
}

img.result {
	width: 100%;
	height; auto;
}

blockquote {
position: relative;
margin: 2em 0;
padding: 1.2em;
font-size: .9em;
background: #DFDFDF;
}

    </style>

	<script language="javascript" type="module">

	import { getConfig } from './js/config.js';

	function gacha (config, rval) {
		let accum = 0;
		for (const entry of config) {
			for (const charID of entry.ids) {
				accum += entry.prob / entry.ids.length;
				if (rval < accum) return { id: charID, rarity: entry.rarity };
			}
		}
		throw new Error('should not reach here');
}

	async function clickGachaButton() {
		const config = await getConfig();
		
		for (var i = 0; i < 10; i++ ) {
			var r = Math.random();
			var filename = 'img/chr/' + gacha(config, r).id + '.png';
			var name = 'result_image' + i;
			var target = document.getElementById(name);
          		target.src = filename;

			document.getElementById(name).textContent = filename;
		}
		
        }

	var button = document.getElementById('gacha_button');
	button.addEventListener('click', () => {
		clickGachaButton();
	});

    </script>

  </head>
  <body>
    <img src="img/sys/logo.png" class="title" />
    <p>SNSなどで使えるフリーアイコンのガチャです。 #魔女図鑑</p>
    <input id="gacha_button" type="button" value="10連ガチャをひく" />
	<ul>
		<li><img src="transparent.png" id="result_image0" class="result"></li>
		<li><img src="transparent.png" id="result_image1" class="result"></li>
		<li><img src="transparent.png" id="result_image2" class="result"></li>
		<li><img src="transparent.png" id="result_image3" class="result"></li>
		<li><img src="transparent.png" id="result_image4" class="result"></li>
	</ul>
	<ul>
		<li><img src="transparent.png" id="result_image5" class="result"></li>
		<li><img src="transparent.png" id="result_image6" class="result"></li>
		<li><img src="transparent.png" id="result_image7" class="result"></li>
		<li><img src="transparent.png" id="result_image8" class="result"></li>
		<li><img src="transparent.png" id="result_image9" class="result"></li>
	</ul>
  </body>
</html>
